<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF 파일 업로드</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .upload-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 2rem;
            margin: 2rem auto;
            max-width: 800px;
        }
        
        .upload-zone {
            border: 3px dashed #007bff;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: #f8f9fa;
            margin: 20px 0;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .upload-zone:hover {
            background: #e9ecef;
            border-color: #0056b3;
        }
        
        .upload-zone.dragover {
            background: #cce5ff;
            border-color: #0056b3;
        }
        
        .file-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .progress {
            height: 20px;
            margin: 10px 0;
        }
        
        .btn-custom {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="upload-container">
            <div class="text-center mb-4">
                <h1 class="text-primary">
                    <i class="fas fa-cloud-upload-alt me-2"></i>
                    PDF 파일 업로드
                </h1>
                <p class="text-muted">관광 가이드 PDF 파일들을 업로드하여 챗봇 지식베이스를 업데이트하세요</p>
            </div>
            
            <!-- 업로드 영역 -->
            <div id="uploadZone" class="upload-zone">
                <i class="fas fa-file-pdf fa-3x text-primary mb-3"></i>
                <h4>PDF 파일을 드래그하거나 클릭하여 선택하세요</h4>
                <p class="text-muted mb-3">최대 10개 파일, 각각 10MB 이하</p>
                <input type="file" id="fileInput" multiple accept=".pdf" style="display: none;">
                <button class="btn btn-custom" onclick="document.getElementById('fileInput').click()">
                    <i class="fas fa-folder-open me-2"></i>파일 선택
                </button>
            </div>
            
            <!-- 선택된 파일 목록 -->
            <div id="fileList" class="file-list" style="display: none;">
                <h5><i class="fas fa-list me-2"></i>선택된 파일들</h5>
                <div id="selectedFiles"></div>
            </div>
            
            <!-- 업로드 진행률 -->
            <div id="uploadProgress" style="display: none;">
                <h6>업로드 진행률</h6>
                <div class="progress">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" 
                         role="progressbar" style="width: 0%"></div>
                </div>
            </div>
            
            <!-- 업로드 버튼 -->
            <div class="text-center mt-4">
                <button id="uploadBtn" class="btn btn-custom btn-lg" onclick="uploadFiles()" disabled>
                    <i class="fas fa-upload me-2"></i>파일 업로드
                </button>
                <button class="btn btn-outline-secondary btn-lg ms-3" onclick="clearFiles()">
                    <i class="fas fa-trash me-2"></i>선택 해제
                </button>
            </div>
            
            <!-- 결과 메시지 -->
            <div id="resultMessage" class="mt-4" style="display: none;"></div>
            
            <!-- 챗봇 링크 -->
            <div class="text-center mt-4">
                <a href="/" class="btn btn-outline-primary">
                    <i class="fas fa-robot me-2"></i>챗봇으로 돌아가기
                </a>
            </div>
            
            <!-- 업로드 가이드 -->
            <div class="mt-5">
                <h5><i class="fas fa-info-circle me-2"></i>업로드 가이드</h5>
                <div class="row">
                    <div class="col-md-6">
                        <h6>✅ 지원되는 파일</h6>
                        <ul>
                            <li>PDF 형식 파일만 지원</li>
                            <li>텍스트 추출 가능한 PDF</li>
                            <li>관광, 여행 관련 내용 권장</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>⚠️ 주의사항</h6>
                        <ul>
                            <li>기존 파일들은 자동으로 교체됩니다</li>
                            <li>업로드 후 시스템 재시작이 필요합니다</li>
                            <li>파일명은 영어/숫자만 권장</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let selectedFiles = [];
        
        // 파일 선택 이벤트
        document.getElementById('fileInput').addEventListener('change', function(e) {
            handleFiles(e.target.files);
        });
        
        // 드래그 앤 드롭 이벤트
        const uploadZone = document.getElementById('uploadZone');
        
        uploadZone.addEventListener('dragover', function(e) {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });
        
        uploadZone.addEventListener('dragleave', function(e) {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
        });
        
        uploadZone.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });
        
        // 클릭으로 파일 선택
        uploadZone.addEventListener('click', function() {
            document.getElementById('fileInput').click();
        });
        
        function handleFiles(files) {
            selectedFiles = [];
            const fileArray = Array.from(files);
            
            fileArray.forEach(file => {
                if (file.type === 'application/pdf' && file.size <= 10 * 1024 * 1024) {
                    selectedFiles.push(file);
                }
            });
            
            displaySelectedFiles();
            updateUploadButton();
        }
        
        function displaySelectedFiles() {
            const container = document.getElementById('selectedFiles');
            const fileList = document.getElementById('fileList');
            
            if (selectedFiles.length === 0) {
                fileList.style.display = 'none';
                return;
            }
            
            fileList.style.display = 'block';
            container.innerHTML = '';
            
            selectedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div>
                        <i class="fas fa-file-pdf text-danger me-2"></i>
                        <strong>${file.name}</strong>
                        <small class="text-muted ms-2">(${(file.size / 1024 / 1024).toFixed(2)} MB)</small>
                    </div>
                    <button class="btn btn-sm btn-outline-danger" onclick="removeFile(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                container.appendChild(fileItem);
            });
        }
        
        function removeFile(index) {
            selectedFiles.splice(index, 1);
            displaySelectedFiles();
            updateUploadButton();
        }
        
        function clearFiles() {
            selectedFiles = [];
            document.getElementById('fileInput').value = '';
            displaySelectedFiles();
            updateUploadButton();
        }
        
        function updateUploadButton() {
            const uploadBtn = document.getElementById('uploadBtn');
            uploadBtn.disabled = selectedFiles.length === 0;
        }
        
        function uploadFiles() {
            if (selectedFiles.length === 0) return;
            
            const formData = new FormData();
            selectedFiles.forEach(file => {
                formData.append('files', file);
            });
            
            // 진행률 표시
            const progressContainer = document.getElementById('uploadProgress');
            const progressBar = progressContainer.querySelector('.progress-bar');
            progressContainer.style.display = 'block';
            progressBar.style.width = '0%';
            
            // 업로드 버튼 비활성화
            document.getElementById('uploadBtn').disabled = true;
            
            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                progressBar.style.width = '100%';
                
                const resultDiv = document.getElementById('resultMessage');
                resultDiv.style.display = 'block';
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle me-2"></i>
                            <strong>업로드 완료!</strong> ${data.message}
                            <br><small>시스템이 자동으로 업데이트되었습니다.</small>
                        </div>
                    `;
                    clearFiles();
                } else {
                    resultDiv.innerHTML = `
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>업로드 실패:</strong> ${data.error}
                        </div>
                    `;
                }
                
                // 3초 후 진행률 숨기기
                setTimeout(() => {
                    progressContainer.style.display = 'none';
                    document.getElementById('uploadBtn').disabled = false;
                }, 3000);
            })
            .catch(error => {
                console.error('Upload error:', error);
                const resultDiv = document.getElementById('resultMessage');
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>네트워크 오류:</strong> 업로드 중 오류가 발생했습니다.
                    </div>
                `;
                
                progressContainer.style.display = 'none';
                document.getElementById('uploadBtn').disabled = false;
            });
        }
    </script>
</body>
</html>